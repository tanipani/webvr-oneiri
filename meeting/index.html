<html>

<head>
	<script src="./../node_modules/aframe/dist/aframe.js"></script>
	<script src="./../node_modules/aframe-extras/dist/aframe-extras.min.js"></script>
	<script src="./../node_modules/aframe-room-component/dist/aframe-room-component.min.js"></script>
</head>

<body>
	<a-scene>
		<a-assets>
			<a-asset-item id="desk" src="assets/desk2/model.dae"></a-asset-item>
			<a-asset-item id="lamp" src="assets/lamp/model.dae"></a-asset-item>
			<a-asset-item id="screen" src="assets/screen/model.dae"></a-asset-item>
			<a-asset-item id="screen_add1" src="assets/screen/model.dae"></a-asset-item>
			<a-asset-item id="screen_add2" src="assets/screen/model.dae"></a-asset-item>
			<a-asset-item id="commode" src="assets/commode/model.dae"></a-asset-item>
			<a-asset-item id="plant" src="assets/plant 2/model.dae"></a-asset-item>
			<a-asset-item id="switch_oneiri" src="assets/switch2/model.dae"></a-asset-item>
			<a-asset-item id="switch_p" src="assets/switch/model.dae"></a-asset-item>
			<a-asset-item id="door" src="assets/door/model.dae"></a-asset-item>
			<a-asset-item id="tablet" src="assets/tablet/model.dae"></a-asset-item>
			<a-asset-item id="house" src="assets/house2/model.dae"></a-asset-item>
			<a-asset-item id="red_button" src="assets/button/model.dae"></a-asset-item>
		</a-assets>
		<a-camera universal-controls="movementControls: checkpoint" checkpoint-controls="mode: animate">
			<a-cursor id="myCursor" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03;" material="color: #CCC; shader:flat;">
			</a-cursor>
		</a-camera>
		<!-- Spawn Room -->
		<rw-room position="0 0 0" material="color:#B1640E" height="4" id="starting-room">
			<rw-floor material="color:#B1640E; src: url(textures/room/floor/floor_light.png); repeat: 0.4 0.6"></rw-floor> <!--material="src: url(textures/room/floor/floor_light.png); repeat: 0.4 0.6"-->
			<rw-ceiling  material="color:#B1640E"></rw-ceiling>
			<rw-wall position="-2 0 -9">
				<rw-doorhole id="entryA"></rw-doorhole>
				<rw-doorlink from="#entryA" to="#entryB" position="2 0 -9" width="0.95"></rw-doorlink>
			</rw-wall>
			<rw-wall position="-2 0 1"></rw-wall>
			<rw-wall position="2 0 1"></rw-wall>
			<rw-wall position="2 0 -9"></rw-wall>
			<!-- checkpoints -->
			<a-entity position="0 0 0">
				<a-cylinder checkpoint="offset: 0 1.5 0" radius="0.5" height="0.01" position="0 0 0" color="#39BB82"></a-cylinder>
				<a-cylinder checkpoint="offset: 0 1.5 0" radius="0.5" height="0.01" position="0 0 -7.5" color="#39BB82"></a-cylinder>
			</a-entity>
			<a-box position="0.389 0.984 -8.939" depth="0.02" height="1" width="0.2"  id="door_handle" opacity="0" scale="1.5 1.5 1"></a-box>
			<a-box position="-0.495 0.015 -9.028" depth="0.01" height="0.01" width="0.01" color="#4CC3D9" id="door_anker" opacity="0">
				<a-entity collada-model="#door" id="the_door" position="0 -0.012 3.285" scale="1.04 0.938 1" rotation="0 180 0"></a-entity>
				<a-animation attribute="rotation"
							 dur="3000"
							 fill="forwards"
							 to="0 -90 0"
							 begin="open_door"></a-animation>
			</a-box>
		</rw-room>

		<rw-room position="0 0 -11" material="color:#B1640E" height="4" id="scene1-room" visible="true">
			<rw-floor material="color:#B1640E;src: url(textures/room/floor/floor_light.png); repeat: 0.4 0.6"></rw-floor>
			<rw-ceiling  material="color:#B1640E"></rw-ceiling>
			<rw-wall position="-4 0 -7">
			</rw-wall>
			<rw-wall position="-4 0 2"></rw-wall>
			<rw-wall position="4 0 2">
				<rw-doorhole id="entryB"></rw-doorhole>
			</rw-wall>
			<rw-wall position="4 0 -7">
			</rw-wall>
			<a-entity collada-model="#plant" position="2.5 0 -6.43" rotation="0 90 0" scale="1.2 1.2 1.2"></a-entity>
			<a-entity collada-model="#plant" position="-2.5 0 -6.437" scale="1.2 1.2 1.2"></a-entity>
			<a-entity collada-model="#lamp" position="-1.3 2.05 -4" scale="1.2 1.2 1.2"></a-entity>
			<a-entity collada-model="#lamp" position="-1.3 2.05 -2" scale="1.2 1.2 1.2"></a-entity>
			<a-entity position="0.260 0 0">
				<a-entity collada-model="#screen" position="-2.54 0.313 -6.051" scale="1.0 1.0 1.0"></a-entity>
				<a-entity collada-model="#screen_add1" id="screen_add1_id" visible="false" position="-0.2 0.313 -6.632" rotation="0 -30 0"></a-entity>
				<a-entity collada-model="#screen_add2" id="screen_add2_id" visible="false" position="-4.264 0.313 -4.392" rotation="0 30 0"></a-entity>
			</a-entity>
			<a-entity collada-model="#commode" position="1.155 0 -6.988" scale="1.3 1.3 1.3" rotation="0 180 0">
			</a-entity>

			<!--<a-entity collada-model="#switch_oneiri" position="-4 1.492 0.593" scale="2 2 2"></a-entity>-->
			<a-box color="#B1640E" id="door_wall" depth="0.01" height="4" width="7"  position="0 2 1.947" scale="1.146 1 1" material="opacity:0.8" visible="false"></a-box>
			<a-box color="#B1640E" id="window_wall" depth="0.01" height="4" width="9"  position="3.992 2 -2.509" rotation="0 90 0" material="opacity:0.8" visible="false"></a-box>
			<a-entity position="0 0 0">
				<a-cylinder checkpoint="offset: 0 1.5 0" radius="0.5" height="0.01" position="0 0 0.5" color="#39BB82"></a-cylinder>
				<a-cylinder checkpoint="offset:0 1.5 0" radius="0.5" height="0.01" position="-2.7 0 0.5" color="#39BB82"></a-cylinder>
			</a-entity>
		</rw-room>
		<rw-room position="0 0.02 -13.753" material="color:#FFFFFF" height="3" class="transition-room" material="opacity:1" scale="2.3 1 2.3">
			<rw-floor id="szeneSwitchF" material="opacity:0;color:#FFFFFF">
				<a-animation dur="4000" attribute="material.opacity" begin="fade" to="1"></a-animation>
				<a-animation dur="4000" attribute="material.opacity" begin="fadeOut" to="0"></a-animation>
			</rw-floor>
			<rw-ceiling id="szeneSwitchC" material="opacity:0;color:#FFFFFF">
				<a-animation dur="4000" attribute="material.opacity" begin="fade" to="1"></a-animation>
				<a-animation dur="4000" attribute="material.opacity" begin="fadeOut" to="0"></a-animation>
			</rw-ceiling>
			<rw-wall position="-1 0 -1" id="szeneSwitchW1" material="opacity:0">
				<a-animation dur="4000" attribute="material.opacity" begin="fade" to="1"></a-animation>
				<a-animation dur="4000" attribute="material.opacity" begin="fadeOut" to="0"></a-animation>
			</rw-wall>
			<rw-wall position="-1 0 1" id="szeneSwitchW2" rotation="0 90 0" material="opacity:0" >
				<a-animation dur="4000" attribute="material.opacity" begin="fade" to="1"></a-animation>
				<a-animation dur="4000" attribute="material.opacity" begin="fadeOut" to="0"></a-animation>
			</rw-wall>
			<rw-wall position="1 0 1" id="szeneSwitchW3" rotation="0 -180 0" material="opacity:0">
				<a-animation dur="4000" attribute="material.opacity" begin="fade" to="1"></a-animation>
				<a-animation dur="4000" attribute="material.opacity" begin="fadeOut" to="0"></a-animation>
			</rw-wall>
			<rw-wall position="1 0 -1" id="szeneSwitchW4" rotation="0 -90 0" material="opacity:0">
				<a-animation id="fadeLastWall" dur="4000" attribute="material.opacity" begin="fade" to="1"></a-animation>
				<a-animation id="outfadeLastWall" dur="4000" attribute="material.opacity" begin="fadeOut" to="0"></a-animation>
			</rw-wall>
			<!-- checkpoints -->
		</rw-room>
		<a-entity collada-model="#desk" id="deskerino" position="-1.669 0 -11.515" scale="1.3 1.3 1.3" visible="true"></a-entity>
		<a-entity collada-model="#house" position="-10.637 -4.657 0.318" scale="2 2 2" id="house_big" visible="false">
			<a-animation attribute="position" to="-9.143 -0.216 12.468" id="garden_animation" begin="garden" fill="forwards"></a-animation>
			<a-animation attribute="position" to="-10.637 -4.657 0.318" id="living_animation" begin="living_room" fill="forwards"></a-animation>
		</a-entity>
		<a-cylinder id="take_seat" checkpoint="offset:0 1.5 0" radius="0.5" height="1.5" position="0 0 -12.1" color="#39BB82" visible="false"></a-cylinder>
		<a-box position="-3.994 1.492 -10.311" depth="0.01" height="0.01" width="0.01" rotation="0 0 0" color="#4CC3D9" material="opacity:0">
			<a-entity collada-model="#switch_oneiri" position="0 0 0" scale="2.4 2.4 2.4" id="switch_oneiri_id"></a-entity>
		</a-box>
		<a-box position="0 0.998 -13" color="#000000" scale="0.22 0.1 0.22" id="red_button_box" opacity="0"></a-box>
		<a-entity collada-model="#red_button" position="-0.052 0.978 -13" scale="2 2 2" id="red_button_id" visible="false" ></a-entity>
		<!--<a-box id="thebox" color="#FFFFFF"></a-box>-->
		<a-sky rotation='0 0 0' id='mySky' src='#'></a-sky>
		<a-box position="-0.007 1.184 -13.951" depth="0.01"  height="2" width="0.01" color="#4CC3D9" opacity="0" id="house_anker">
			<a-entity collada-model="#house" position="-0.466 0 0.503" scale="0.05 0.05 0.05" id="house_small" visible="false">
				<a-animation id="grow_big_animation" attribute="scale" begin="grow_big" dur="9000" to="2 2 2"></a-animation>
			</a-entity>
				<a-animation attribute="rotation"
							 dur="10000"
							 pauseEvents="rotation-pause"
							 fill="forwards"
							 to="0 360 0"
							 repeat="indefinite"/>
		</a-box>
		<a-box position="0 1.196 -13.5" color="#000000" scale="0.3 0.2 0.1" id="tablet_box" opacity="0" rotation="-17 0 0"></a-box>
		<a-entity collada-model="#tablet" id="tablet_id" visible="false" position="0 1.2 -13.5" scale="1.5 1.5 1.5" rotation="0 90 70"></a-entity>
	</a-scene>




	<!--<script src="index.js"></script>-->
	<script type="text/javascript">
        var cursorVar = document.getElementById('myCursor');
        var houseSzene = false;
		var buttonPressedOnce = false;
		var buttonPressedTwice = false;
		var isOneiriOn = false;
		var inGarden = false;

		// COLOR

        document.getElementById('door_handle').addEventListener('mouseenter', function() {
            cursorVar.setAttribute('color', '#e74c3c');
        });

        document.getElementById('door_handle').addEventListener('mouseleave', function() {
            cursorVar.setAttribute('color', '#CCC');
        });

        document.getElementById('switch_oneiri_id').addEventListener('mouseenter', function() {
                cursorVar.setAttribute('color', '#e74c3c');
        });

        document.getElementById('switch_oneiri_id').addEventListener('mouseleave', function() {
                cursorVar.setAttribute('color', '#CCC');
        });

        document.getElementById('tablet_box').addEventListener('mouseenter', function() {
            if(document.getElementById('tablet_id').getAttribute('visible')) {
                cursorVar.setAttribute('color', '#e74c3c');
            }
        });

        document.getElementById('tablet_box').addEventListener('mouseleave', function() {
            cursorVar.setAttribute('color', '#CCC');
        });


        document.getElementById('house_small').addEventListener('mouseenter', function() {
            if(document.getElementById('house_small').getAttribute('visible')){
                cursorVar.setAttribute('color', '#e74c3c');
			}
        });

        document.getElementById('house_small').addEventListener('mouseleave', function() {
            cursorVar.setAttribute('color', '#CCC');
        });

        document.getElementById('red_button_box').addEventListener('mouseenter', function() {
            if(document.getElementById('red_button_id').getAttribute('visible')) {
                if (!(document.getElementById('house_small').getAttribute('visible')) && !(document.getElementById('tablet_id').getAttribute('visible'))) {
                    cursorVar.setAttribute('color', '#e74c3c');
                }
            }
        });

        document.getElementById('take_seat').addEventListener('mouseenter', function() {
            if(isOneiriOn){
                cursorVar.setAttribute('color', '#e74c3c');
            }
        });

        document.getElementById('take_seat').addEventListener('mouseleave', function() {
            cursorVar.setAttribute('color', '#CCC');
        });


        document.getElementById('red_button_box').addEventListener('mouseleave', function() {
            cursorVar.setAttribute('color', '#CCC');
        });

        // ACTION


        document.getElementById('red_button_box').addEventListener('click', function(evt) {
            if(isOneiriOn && document.getElementById('red_button_id').getAttribute('visible')){
                if(!buttonPressedOnce){
                    buttonPressedOnce = true;
                    document.getElementById('screen_add1_id').setAttribute('visible', 'true');
                    document.getElementById('screen_add2_id').setAttribute('visible', 'true');
                }
                else if(!buttonPressedTwice){
                    buttonPressedTwice = true;
                    document.getElementById('house_small').setAttribute('visible', 'true');
                }
                else if(houseSzene && !(document.getElementById('tablet_id').getAttribute('visible'))){
                    document.getElementById('tablet_id').setAttribute('visible', 'true');
                }
                else if(inGarden && !(document.getElementById('tablet_id').getAttribute('visible')) ){
                    fadeIn();
                }
			}

		});
        document.getElementById('switch_oneiri_id').addEventListener('click', function(evt) {
            if(!isOneiriOn){
                isOneiriOn = true;
                document.getElementById('door_wall').setAttribute('visible', 'true');
			}
			else{
                houseSzene = false;
				buttonPressedOnce = false;
				buttonPressedTwice = false;
				isOneiriOn = false;
                inGarden = false;
                document.getElementById('red_button_id').setAttribute('visible', 'false');
                document.getElementById('house_small').setAttribute('visible', 'false');
                document.getElementById('door_wall').setAttribute('visible', 'false');
                document.getElementById('screen_add1_id').setAttribute('visible', 'false');
                document.getElementById('screen_add2_id').setAttribute('visible', 'false');
                document.getElementById('tablet_id').setAttribute('visible', 'false');

			}
        });

        document.getElementById('tablet_box').addEventListener('click', function(evt) {
            if(isOneiriOn && document.getElementById('tablet_id').getAttribute('visible')) {
                if(!inGarden){
                    fadeIn();
				}
				if(inGarden){
                    document.getElementById('tablet_id').setAttribute('visible', 'false');
				}
            }
        });

        document.getElementById('take_seat').addEventListener('click', function(evt) {
            if(isOneiriOn) {
                document.getElementById('red_button_id').setAttribute('visible', 'true');
            }
        });

        document.getElementById('house_small').addEventListener('click', function(evt) {
            if(document.getElementById('house_small').getAttribute('visible')){
                fadeIn();
			}
        });
        document.getElementById('fadeLastWall').addEventListener('animationend', function () {
            if(!houseSzene && !inGarden){
                document.getElementById('mySky').setAttribute('src', 'textures/sky.jpg');
                document.getElementById('house_small').setAttribute('visible', 'false');
                document.getElementById('starting-room').setAttribute('visible', 'false');
                document.getElementById('scene1-room').setAttribute('visible', 'false');
                document.getElementById('house_big').setAttribute('visible', 'true');
                fadeOut();
                houseSzene = true;
			}
			else if(houseSzene && !inGarden){
                houseSzene = false;
                document.getElementById('house_big').setAttribute('visible', 'false');
                document.getElementById('house_big').emit("garden");
                inGarden = true;
			}
            else if(!houseSzene && inGarden){
                inGarden = false;
                document.getElementById('house_big').setAttribute('visible', 'false');
                document.getElementById('house_small').setAttribute('visible', 'true');
                document.getElementById('starting-room').setAttribute('visible', 'true');
                document.getElementById('scene1-room').setAttribute('visible', 'true');
                document.getElementById('house_big').emit("living_room");
            }

        });

        function fadeIn() {
            document.getElementById('szeneSwitchF').emit("fade");
            document.getElementById('szeneSwitchC').emit("fade");
            document.getElementById('szeneSwitchW1').emit("fade");
            document.getElementById('szeneSwitchW2').emit("fade");
            document.getElementById('szeneSwitchW3').emit("fade");
            document.getElementById('szeneSwitchW4').emit("fade");
        }

        function fadeOut(){
            document.getElementById('szeneSwitchF').emit("fadeOut");
            document.getElementById('szeneSwitchC').emit("fadeOut");
            document.getElementById('szeneSwitchW1').emit("fadeOut");
            document.getElementById('szeneSwitchW2').emit("fadeOut");
            document.getElementById('szeneSwitchW3').emit("fadeOut");
            document.getElementById('szeneSwitchW4').emit("fadeOut");
		}

        document.getElementById('door_handle').addEventListener('click', function(evt) {
            document.getElementById('door_handle').setAttribute('visible', 'false');
            document.getElementById('door_anker').emit("open_door");
        });

        document.getElementById('garden_animation').addEventListener('animationend', function () {
            fadeOut();
            document.getElementById('house_big').setAttribute('visible', 'true');
		});
        document.getElementById('living_animation').addEventListener('animationend', function () {
            fadeOut();
            document.getElementById('mySky').setAttribute('src', '');
        });


	</script>

</body>

</html>
